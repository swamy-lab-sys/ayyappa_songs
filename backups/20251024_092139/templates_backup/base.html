<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Swamiye Saranam Ayyappa{% endblock %}</title>

  {% load static %}

  <!-- üïâÔ∏è PWA Meta Tags -->
  <meta name="description" content="Multilingual Devotional Songs ‚Äì Tamil, Telugu, English" />
  <meta name="theme-color" content="#d97706" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Ayyappa Songs" />

  <!-- üì± Manifest & Icons -->
  <link rel="manifest" href="{% static 'manifest.json' %}" />
  <link rel="apple-touch-icon" href="{% static 'icons/icon-192.png' %}" />
  <link rel="icon" type="image/png" href="{% static 'icons/icon-192.png' %}" />

  <!-- üåà Tailwind CSS (Local Build) -->
  <link rel="stylesheet" href="{% static 'css/tailwind.min.css' %}" />

  <!-- üéµ Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    /* === Brand Styling === */
    .nav-gradient {
      background: linear-gradient(90deg, #f59e0b, #d97706, #9333ea);
      background-size: 300% 300%;
      animation: gradientFlow 8s ease infinite;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .nav-link { position: relative; transition: all 0.3s ease; }
    .nav-link:hover { color: #fff; text-shadow: 0 0 10px #fef3c7; }
    .nav-link::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -2px;
      width: 0;
      height: 2px;
      background: #facc15;
      transition: width 0.3s ease;
    }
    .nav-link:hover::after { width: 100%; }
    .mobile-menu-btn { transition: transform 0.2s ease; }
    .mobile-menu-btn:active { transform: scale(0.95); }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn { animation: fadeIn 0.6s ease forwards; }
    body { font-family: "Inter", sans-serif; background-color: #faf9f6; }
  </style>

  {% block extra_head %}{% endblock %}
</head>

<body class="text-gray-800 antialiased">
  <!-- üåÑ Navbar -->
  <nav class="nav-gradient shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-8">
      <div class="flex justify-between items-center h-16 text-white">
        <div class="flex items-center gap-2">
          <i class="fa-solid fa-om text-yellow-300 text-2xl drop-shadow-md"></i>
          <a href="/" class="text-xl font-semibold tracking-wide hover:text-yellow-100 transition">
            Swamiye Saranam Ayyappa
          </a>
        </div>

        <!-- üì± Desktop Links -->
        <div class="hidden md:flex items-center gap-6 text-sm font-medium">
          <a href="/" class="nav-link flex items-center gap-1">
            <i class="fa-solid fa-music"></i> Home
          </a>
          {% if user.is_authenticated %}
            {% if user.is_staff %}
              <a href="{% url 'admin_users_dashboard' %}" class="nav-link flex items-center gap-1">
                <i class="fa-solid fa-users"></i> Manage Users
              </a>
              <a href="{% url 'admin_access_requests' %}" class="nav-link flex items-center gap-1">
                <i class="fa-solid fa-inbox"></i> Requests
              </a>
              <a href="{% url 'song_add' %}" class="nav-link flex items-center gap-1">
                <i class="fa-solid fa-plus"></i> Add Song
              </a>
            {% else %}
              <a href="{% url 'my_requests' %}" class="nav-link flex items-center gap-1">
                <i class="fa-solid fa-list-check"></i> My Requests
              </a>
              <a href="{% url 'song_add' %}" class="nav-link flex items-center gap-1">
                <i class="fa-solid fa-plus"></i> Add Song
              </a>
            {% endif %}
            <span class="text-yellow-200">
              <i class="fa-solid fa-user"></i> Hi, {{ user.username }}
            </span>
            <a href="{% url 'logout' %}" class="nav-link flex items-center gap-1">
              <i class="fa-solid fa-right-from-bracket"></i> Logout
            </a>
          {% else %}
            <a href="{% url 'login' %}" class="nav-link flex items-center gap-1">
              <i class="fa-solid fa-right-to-bracket"></i> Login
            </a>
          {% endif %}
        </div>

        <!-- üçî Mobile Menu Button -->
        <div class="md:hidden">
          <button id="menuToggle" class="mobile-menu-btn text-2xl">
            <i class="fa-solid fa-bars"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- üì± Mobile Menu -->
    <div id="mobileMenu"
         class="hidden flex flex-col bg-gradient-to-b from-orange-600 via-amber-600 to-purple-800 text-white text-sm px-6 py-3 space-y-3 md:hidden">
      <a href="/" class="nav-link flex items-center gap-2">
        <i class="fa-solid fa-music"></i> Home
      </a>
      {% if user.is_authenticated %}
        {% if user.is_staff %}
          <a href="{% url 'admin_users_dashboard' %}" class="nav-link flex items-center gap-2">
            <i class="fa-solid fa-users"></i> Manage Users
          </a>
          <a href="{% url 'admin_access_requests' %}" class="nav-link flex items-center gap-2">
            <i class="fa-solid fa-inbox"></i> Access Requests
          </a>
          <a href="{% url 'song_add' %}" class="nav-link flex items-center gap-2">
            <i class="fa-solid fa-plus"></i> Add Song
          </a>
        {% else %}
          <a href="{% url 'my_requests' %}" class="nav-link flex items-center gap-2">
            <i class="fa-solid fa-list-check"></i> My Requests
          </a>
          <a href="{% url 'song_add' %}" class="nav-link flex items-center gap-2">
            <i class="fa-solid fa-plus"></i> Add Song
          </a>
        {% endif %}
        <span class="flex items-center gap-2 text-yellow-200">
          <i class="fa-solid fa-user"></i> Hi, {{ user.username }}
        </span>
        <a href="{% url 'logout' %}" class="nav-link flex items-center gap-2">
          <i class="fa-solid fa-right-from-bracket"></i> Logout
        </a>
      {% else %}
        <a href="{% url 'login' %}" class="nav-link flex items-center gap-2">
          <i class="fa-solid fa-right-to-bracket"></i> Login
        </a>
      {% endif %}
    </div>
  </nav>

  <!-- üçû Breadcrumbs -->
  {% block breadcrumbs %}
  <div class="bg-white border-b border-amber-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-8 py-3">
      <nav class="flex text-sm text-gray-600" aria-label="Breadcrumb">
        <a href="{% url 'song_list' %}" class="hover:text-amber-700 transition">
          <i class="fa-solid fa-home"></i> Home
        </a>
        {% block breadcrumb_extra %}{% endblock %}
      </nav>
    </div>
  </div>
  {% endblock %}

  <!-- ‚ú® Main Content -->
  <main class="animate-fadeIn min-h-screen bg-gradient-to-b from-amber-50/30 to-white">
    {% if messages %}
      <div class="max-w-7xl mx-auto px-4 sm:px-8 py-4">
        {% for message in messages %}
          <div class="mb-3 p-4 rounded-lg 
               {% if message.tags == 'error' %}bg-red-100 text-red-800 border border-red-300
               {% elif message.tags == 'success' %}bg-green-100 text-green-800 border border-green-300
               {% elif message.tags == 'warning' %}bg-yellow-100 text-yellow-800 border border-yellow-300
               {% else %}bg-blue-100 text-blue-800 border border-blue-300{% endif %}">
            <div class="flex items-center gap-2">
              <i class="fa-solid 
                 {% if message.tags == 'error' %}fa-circle-exclamation
                 {% elif message.tags == 'success' %}fa-circle-check
                 {% elif message.tags == 'warning' %}fa-triangle-exclamation
                 {% else %}fa-circle-info{% endif %}">
              </i>
              <span>{{ message }}</span>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    {% block content %}{% endblock %}
  </main>

  <!-- üåô Footer -->
  <footer class="mt-12 py-6 text-center text-sm text-gray-500 border-t border-amber-100 bg-white/60">
    <p>üïâÔ∏è <span class="text-amber-700 font-medium">Swamiye Saranam Ayyappa</span> ‚Ä¢ Created with Faith & Devotion</p>
  </footer>

  <!-- üì± Mobile Menu Toggle -->
  <script>
    const toggle = document.getElementById("menuToggle");
    const menu = document.getElementById("mobileMenu");
    toggle.addEventListener("click", () => {
      menu.classList.toggle("hidden");
      toggle.querySelector("i").classList.toggle("fa-bars");
      toggle.querySelector("i").classList.toggle("fa-xmark");
    });
  </script>

  <!-- üïâÔ∏è Service Worker + Install Button -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("{% static 'service-worker.js' %}")
          .then(() => {
            console.log("‚úÖ Service Worker registered");
          })
          .catch((error) => {
            console.error("‚ùå Service Worker failed:", error);
          });
      });
    }

    let deferredPrompt = null;

    window.addEventListener("beforeinstallprompt", (event) => {
      event.preventDefault();
      deferredPrompt = event;

      const installBtn = document.createElement("button");
      installBtn.textContent = "üì≤ Install Ayyappa Songs";
      installBtn.className =
        "fixed bottom-6 right-6 bg-amber-600 text-white px-5 py-3 rounded-full shadow-lg hover:bg-amber-700 transition z-50";
      document.body.appendChild(installBtn);

      installBtn.addEventListener("click", async () => {
        if (!deferredPrompt) return;
        
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        if (outcome === "accepted") {
          console.log("‚úÖ PWA installed");
        }
        
        deferredPrompt = null;
        installBtn.remove();
      });
    });

    window.addEventListener("appinstalled", () => {
      console.log("‚úÖ App installed successfully");
      deferredPrompt = null;
    });
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
