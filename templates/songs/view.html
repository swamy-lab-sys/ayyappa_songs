{% extends 'base.html' %}

{% block title %}{{ song.get_title }}{% endblock %}

{% block breadcrumb_extra %}
<span class="mx-2">‚Ä∫</span>
<a href="{% url 'song_list' %}" 
   class="inline-flex items-center gap-2 ml-4 px-3 py-1.5 bg-gradient-to-r from-amber-500 to-orange-500 
          hover:from-amber-600 hover:to-orange-600 text-white text-sm font-medium rounded-lg shadow-sm transition-all duration-200">
  <i class="fa-solid fa-plus"></i>
 Songs List
</a>
<span class="mx-2">‚Ä∫</span>
<span class="text-amber-700 font-medium">{{ song.get_title|truncatewords:5 }}</span>
{% endblock %}

{% block content %}
<div class="relative w-full min-h-screen bg-gradient-to-b from-amber-50 to-white">

  <!-- Fixed Action Buttons (Mobile & Desktop) -->
  <div class="no-print sticky top-20 z-40 bg-white/95 backdrop-blur-sm border-b border-amber-200 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 sm:px-8 py-3">
      <div class="flex flex-wrap gap-2 justify-between items-center">
        <div class="flex gap-2">
          <a href="{% url 'song_list' %}" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md transition text-sm">
            <i class="fa-solid fa-arrow-left"></i> Back
          </a>
          <a href="{% url 'song_edit' song.id %}" class="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition text-sm">
            <i class="fa-solid fa-edit"></i> Edit
          </a>
          {% if missing_langs %}
          <a href="{% url 'song_add_language' song.id %}" class="px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition text-sm">
            <i class="fa-solid fa-plus"></i> Add Language
          </a>
          {% endif %}
        </div>
        
        <div class="flex gap-2">
          {% if song.get_audio_url or song.audio_file.youtube_url %}
          <a href="{% url 'song_download' song.id %}" class="px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition text-sm">
            <i class="fa-solid fa-headphones"></i> Audio
          </a>
          {% endif %}
          <a href="{% url 'song_download_pdf' song.id %}" class="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md transition text-sm">
            <i class="fa-solid fa-file-pdf"></i> PDF
          </a>
          <button onclick="window.print()" class="px-3 py-2 bg-gradient-to-r from-sky-500 to-amber-500 text-white rounded-md transition text-sm hover:shadow-lg">
            <i class="fa-solid fa-print"></i> Print
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-5xl mx-auto py-8 px-4 sm:px-8">

    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-6xl font-bold text-amber-500 animate-pulse mb-4">‡•ê</div>
      <h1 class="text-4xl sm:text-5xl font-bold text-amber-800 mb-2">{{ song.get_title }}</h1>
      <div class="flex flex-wrap justify-center gap-2 mt-3">
        {% for lang_code, lang_name in available_langs %}
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-800">
          {{ lang_name }}
        </span>
        {% endfor %}
      </div>
      <p class="text-sm text-gray-600 mt-3 italic">
        Uploaded by <strong>{{ song.owner.username }}</strong> ‚Ä¢ {{ song.uploaded_at|date:"F j, Y" }}
      </p>
    </div>

    <!-- Cover Image -->
    {% if song.cover_image %}
    <div class="max-w-3xl mx-auto mb-10">
      <img src="{{ song.cover_image.url }}" alt="{{ song.get_title }}"
           class="w-full rounded-2xl border-4 border-amber-400 shadow-2xl object-cover max-h-[400px] mx-auto transition-transform hover:scale-[1.02]">
    </div>
    {% endif %}

    <!-- Audio Player -->
    {% if song.get_audio_url %}
    <div class="max-w-3xl mx-auto mb-10">
      <div class="bg-gradient-to-r from-amber-100 to-orange-100 rounded-xl p-6 shadow-lg border border-amber-300">
        <div class="flex items-center gap-3 mb-3">
          <i class="fa-solid fa-music text-amber-700 text-2xl"></i>
          <h3 class="text-lg font-semibold text-amber-900">Audio Player</h3>
        </div>
        <audio id="audioPlayer" controls class="w-full rounded-lg shadow-md border border-amber-300 bg-white">
          <source src="{{ song.get_audio_url }}" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
        <p class="text-xs text-gray-600 mt-2 text-center">
          <i class="fa-solid fa-play-circle"></i> Played {{ song.play_count }} times
        </p>
      </div>
    </div>
    {% endif %}

    <!-- Language Tab Buttons -->
    <div class="flex justify-center flex-wrap gap-3 mb-8">
      {% for lang_code, lang_name in available_langs %}
      <button 
        data-lang="{{ lang_code }}" 
        class="lang-btn {% if forloop.first %}active{% endif %} px-5 py-2 rounded-full font-semibold text-sm transition-all duration-200">
        {% if lang_code == "tamil" %}
          üïâ {{ lang_name }}
        {% elif lang_code == "telugu" %}
          üí† {{ lang_name }}
        {% elif lang_code == "english" %}
          üåê {{ lang_name }}
        {% endif %}
      </button>
      {% endfor %}
    </div>

    <!-- Lyrics Container with Language Switching -->
    <div class="max-w-4xl mx-auto bg-white/95 rounded-3xl border-2 border-amber-200 shadow-2xl p-8 sm:p-12 mb-8">
      {% for lang_code, lang_name in available_langs %}
      <div id="lyrics-{{ lang_code }}" class="lyrics-block {% if not forloop.first %}hidden{% endif %}">
        <h2 class="text-2xl font-bold text-center text-amber-800 mb-6 border-b-2 border-amber-300 pb-3">
          {% if lang_code == "tamil" %}{{ song.title_ta|default:lang_name }}{% elif lang_code == "telugu" %}{{ song.title_te|default:lang_name }}{% elif lang_code == "english" %}{{ song.title_en|default:lang_name }}{% endif %}
        </h2>
        <div class="lyrics-text whitespace-pre-line text-xl sm:text-2xl leading-[2.2] tracking-wide text-gray-800 font-medium">
          {% if lang_code == "tamil" %}{{ song.lyrics_ta|default:"No lyrics available in Tamil."|linebreaksbr }}{% elif lang_code == "telugu" %}{{ song.lyrics_te|default:"No lyrics available in Telugu."|linebreaksbr }}{% elif lang_code == "english" %}{{ song.lyrics_en|default:"No lyrics available in English."|linebreaksbr }}{% endif %}
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Footer -->
    <div class="text-center mb-8">
      <div class="text-3xl mb-3">‚úø ‚ùÄ ‚úø</div>
      <h2 class="text-3xl sm:text-4xl font-bold text-amber-700 tracking-wide mb-2">
        üïâÔ∏è SWAMIYE SARANAM AYYAPPA üïâÔ∏è
      </h2>
      <p class="text-sm italic text-gray-500 mt-2">May Lord Ayyappan bless you with devotion and peace.</p>
    </div>

  </div>
</div>

<!-- Styles for Language Buttons and Lyrics -->
<style>
.lang-btn {
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  color: white;
  box-shadow: 0 2px 6px rgba(251, 191, 36, 0.3);
}

.lang-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.5);
}

.lang-btn.active {
  background: linear-gradient(135deg, #92400e, #b45309);
  box-shadow: 0 4px 12px rgba(146, 64, 14, 0.6);
  transform: scale(1.05);
}

.lyrics-block.hidden {
  display: none;
}

.lyrics-text {
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

/* Print Styles */
@media print {
  .no-print {
    display: none !important;
  }
  
  body {
    background: white;
  }
  
  .lyrics-text {
    font-size: 14pt;
    line-height: 1.8;
  }
  
  .lyrics-block {
    display: block !important;
    page-break-before: always;
  }
  
  .lyrics-block:first-child {
    page-break-before: auto;
  }
}
</style>

<!-- JavaScript for Language Switching -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const langButtons = document.querySelectorAll('.lang-btn');
  const lyricsBlocks = document.querySelectorAll('.lyrics-block');
  
  langButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const lang = this.dataset.lang;
      
      // Update button states
      langButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      // Show selected lyrics with animation
      lyricsBlocks.forEach(block => {
        block.classList.add('hidden');
      });
      
      const targetBlock = document.getElementById(`lyrics-${lang}`);
      targetBlock.classList.remove('hidden');
      
      // Smooth animation
      gsap.from(targetBlock, {
        opacity: 0,
        y: 20,
        duration: 0.5,
        ease: "power2.out"
      });
    });
  });
  
  // Audio player animation on play
  const audio = document.getElementById('audioPlayer');
  if (audio) {
    audio.addEventListener('play', () => {
      const activeLyrics = document.querySelector('.lyrics-block:not(.hidden) .lyrics-text');
      if (activeLyrics) {
        gsap.to(activeLyrics, {
          opacity: 1,
          scale: 1.01,
          duration: 0.8,
          yoyo: true,
          repeat: 1,
          ease: "power1.inOut"
        });
      }
    });
  }
});
</script>
{% endblock %}
